{% extends "app/layout.html" %}
{% load staticfiles %}
{% load bootstrap_components %}

{% block content %}
<h2>{{ scenario.name|escape }}</h2>

<a class='btn btn-default' href="{% url 'project_detail' scenario.project.id %}">&laquo; Back to project</a>

<div>
    {{ scenario.description|escape|linebreaks }}
</div>

<div>
    <div class='row'>
    {% if scenario.source_type == gage_type %}
    <div class='col-md-4'>
        Period of Record: {{ scenario.start_date }} to {{ scenario.end_date }}
        <table class="table table-striped">
            <thead>
                <th>Target ({{ scenario.attribute_units_abbr|escape }})</th>
                <th>From</th>
                <th>To</th>
            </thead>
            <tbody>
            {% for element in converted_targets %}
                <tr>
                    <td>{{ element.target_value }}</td>
                    <td>{{ element.from_month }}-{{ element.from_day }}</td>
                    <td>{{ element.to_month }}-{{ element.to_day }}</td>
                </tr>
            {% endfor %}
            <tbody>
        </table>
    </div>
    {% else %}
    <div>Flow and target data from
        <a href="{{ scenario.excel_file.data_file.url }}">
            {{ scenario.excel_file }}
        </a>
    <div>
    {% endif %}
    </div>

    <div class='row'>
        <div id="average-plot"></div>
    </div>
    {% if user.is_authenticated %}
        <div>
            <a class='btn btn-default'
                href="/admin/flowviz/scenario/{{ scenario.id }}?navsource=main">Edit Scenario &raquo;</a>
        </div>
    {% endif %}
</div>

<div>
    <h2>Water Data</h2>
    <div class='row'>
        <div class='col-md-6'>
            {% bootstrap_modal_show "raster-flow-help" %}
            <div id="img-total"></div>
        </div>
        <div class='col-md-6'>
            {% bootstrap_modal_show "raster-deficit-help" %}
            <div id="img-gap"></div>
        </div>
    </div>
</div>

<div>
    <h2>Environmental Flow Sufficiency</h2>
    <h3>Temporal Deficit {% bootstrap_modal_show "eflow-temporal-deficit-help" %}</h3>
    <div class="row">
        <div class='col-md-6'>
            <div id="img-pct"></div>
        </div>
        <div class='col-md-6'>
            <div id="img-pct-annual"></div>
        </div>
    </div>
    <div class="row">
        <h3>Volumetric Deficit {% bootstrap_modal_show "eflow-volumetric-deficit-help" %}</h3>
        <div class="row">
            <div class='col-md-6'>
                <div id="img-stats-pct"></div>
            </div>
            <div class='col-md-6'>
                <div id="img-stats-pct-annual"></div>
            </div>
        </div>
        <div class="row">
            <div class='col-md-6'>
                <div id="img-stats"></div>
            </div>
            <div class='col-md-6'>
                <div id="img-stats-annual"></div>
            </div>
        </div>
    </div>
</div>

{% bootstrap_modal "Raster Plot" raster-flow-help %}
    This graph shows the {{ scenario.attribute_name|escape }} value over
    the entire period of record. Each
    row of pixels in the graph represents the river flow for 1 year. The years
    are stacked on top of one another to provide a view of the value over the
    full period of record.
{% endbootstrap_modal %}

{% bootstrap_modal "Raster plot" raster-deficit-help %}
    This graph shows the "{{ scenario.attribute_name|escape }}" deficit over
    the entire period of record. Each
    row of pixels in the graph represents the deficit for 1 year. The years
    are stacked on top of one another to provide a view of the value over the
    full period of record.
{% endbootstrap_modal %}

{% include "flowviz/wait_dialog.django.html" with loading_message="Loading data..." %}

{% include "flowviz/indicator_help.django.html" %}

{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'flowviz/d3.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'flowviz/mpld3.v0.2.js' %}"></script>
    <script type="text/javascript" src="{% static 'flowviz/mpld3.plugins.js' %}"></script>
    <script src="{% static 'flowviz/common.js' %}"></script>
    <script src="{% static 'flowviz/scenario.js' %}"></script>
    <script type='text/javascript'>
        var attribute_name = "{{ attribute_name|escapejs }}"
        var gap_attribute_name = "{{ gap_attribute_name|escapejs }}"
        var scenario = {
            name: "{{ scenario.name|escapejs }}",
            description: "{{ scenario.description|escapejs }}",
            attribute_name: "{{ scenario.attribute_name|escapejs }}",
            attribute_units: "{{ scenario.attribute_units|escapejs }}",
            attribute_units_abbr: "{{ scenario.attribute_units_abbr|escapejs }}"
        }

        var imgUrls = {
            total: "{% url 'scenario-dynamic-raster' scenario.id %}",
            gap: "{% url 'scenario-dynamic-raster' scenario.id %}",
            stats: "{% url 'scenario-deficit-stats' scenario.id %}",
            stats_annual: "{% url 'scenario-deficit-stats-annual' scenario.id %}",
            stats_pct: "{% url 'scenario-deficit-stats-pct' scenario.id %}",
            stats_pct_annual: "{% url 'scenario-deficit-stats-pct-annual' scenario.id %}",
            pct: "{% url 'scenario-deficit-days' scenario.id %}",
            pct_annual: "{% url 'scenario-deficit-days-annual' scenario.id %}",
        }

        var dataUrls = {
            average: "{% url 'scenario-average' scenario.id %}",
        };

        $(document).ready(function () {
            Scenario.initialize(scenario, imgUrls)
        });
    </script>
{% endblock %}
